const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ShrinkingEmptyState-B9CFHPUa.js","yjs-Cyj2tZeb.js","sentry-BPH6silo.js","a1b2c3-BIUAe2b4.js","lodash-JQs4LXD6.js","date-fns-CZMN4x1g.js","zod-C4a_jWXR.js","statsig-CciSPO6z.js","cheerio-DQLnZxVv.js","rxjs-BCoeeh2h.js","apollo-client-CiAgU1zi.js","actions-BSn0aWLf.js","actions-D8Kpdt48.css","empty-state-4bt6-Jtb.js","UnsavedViewChangesBanner-D5iQLql4.js","DatabaseSpotlight-BgcakTac.js","spotlight-manager-dcrT13_j.js","DatabaseFatalError-CkLhcYzI.js"])))=>i.map(i=>d[i]);
import{r as i,n as K,ai as O,R as m,o as De,a3 as me,p as we,b7 as xe,h as x,m as Te}from"./a1b2c3-BIUAe2b4.js";import{af as j,bs as Ae,bt as Re,bu as _e,ac as C,j as r,o as P,bv as Le,w as te,at as Pe,a1 as ke,bw as Be,ay as Oe,y as J,b as W,A as Ve,a6 as Ne,a7 as Fe,bx as je,by as fe,bz as Me,bA as ze,ak as ae,u as q,bB as se,br as ge,t as ne,I as Ue,bC as He,bD as M,O as Ye,J as re,bE as Ge,bF as qe,bG as Ke,bH as Je,bI as We,bJ as $e,bK as Qe,bL as Xe,ai as Ze,bM as et,bN as tt}from"./yjs-Cyj2tZeb.js";import{aI as at,eh as $,S as st,j as nt,aX as rt,c0 as ot,n as oe,N as it,er as lt,x as Q,d as I,es as ct,et as dt,eu as ut,aU as pt,m as V,ec as mt,bk as ft,ev as gt,bl as Et,ew as ht,bu as bt,by as yt,ex as Ct,d0 as It,aQ as X,ey as St,J as vt,ez as z,a6 as Dt,eA as ie,eB as wt,ay as Ee,ax as he,ab as xt,k as B,G as Tt,z as At,eC as Rt,au as _t,eD as Lt,eE as Pt,eF as kt,av as R,aw as Bt,az as le,aA as ce,aK as de,aN as Ot,eG as Vt,aL as Nt,aR as be,aB as Ft,aC as jt,aD as Mt,aF as zt,aG as Ut,aH as Ht,aJ as Yt,aM as U,aO as Gt,aP as qt,aS as Kt}from"./actions-BSn0aWLf.js";import{D as Jt,p as w,d as ye,B as Wt,a as $t,f as Qt,g as H,h as ue}from"./statsig-CciSPO6z.js";import{p as Xt,z as Zt,u as Ce,x as ea,y as ta}from"./sentry-BPH6silo.js";import{D as aa,b as sa,c as na}from"./DatabaseSpotlight-BgcakTac.js";import{a as ra}from"./spotlight-manager-dcrT13_j.js";const k=Xt({data:{spaceKey:"",contentId:"",cloudId:"",activationId:"",contentReferenceId:"",userId:"",spaceId:"",spaceName:"",title:"",identity:{accountId:"",nickname:"",picture:"",email:"",locale:""},token:{container:"",board:"",accessToken:"",mediaToken:"",mediaBaseUrl:"",mediaCollectionId:"",policies:{dataSecurityPolicy:{pageExport:void 0}}}}}),Ie=new Jt,Y=e=>{if(e)try{const a=JSON.parse(e);return a&&(w.timeLog("app-initialization","bridge-data"),ye.resolve("EventBus").dispatch(new Wt({oldContentId:k.data.contentId,newContentId:a.contentId})),k.data=a,Ie.resolve(k.data)),a}catch{throw new Error("Bridge data are not valid JSON")}},oa=async()=>{var a;if(window.location.search.includes("bridgeData")){const n=new URLSearchParams(window.location.search).get("bridgeData");return Y(n),JSON.parse(n)}return Y((a=window.frameElement)==null?void 0:a.getAttribute("data-bridge-data")),new MutationObserver(t=>{t.forEach(n=>{var s;if(n.type==="attributes"){const o=(s=window.frameElement)==null?void 0:s.getAttribute("data-bridge-data");o&&Y(o)}})}).observe(window.frameElement,{attributes:!0,attributeFilter:["data-bridge-data"]}),await Ie.get()};var L={VITE_SHOULD_THROW_ON_INVARIANTS:"false",VITE_CANVAS_RELAY_URL:"https://canvas-workers.atlassian.com",VITE_CANVAS_RELAY_WSS_URL:"wss://canvas-workers.atlassian.com",VITE_SHORT_COMMIT_HASH:"79b5d4",VITE_USER_NODE_ENV:"production",SENTRY_DSN:"https://c539b3edb4ba4437b37ac70f1d1a088a@o55978.ingest.sentry.io/4505121292484608",SENTRY_ENV:"prod",SENTRY_RELEASE:"dev",ENVTYPE:"prod",BUILD_MODE:"prod-east"};const ia=({cloudId:e,spaceId:a,userId:t})=>{w.timeLog("app-initialization","analytics"),at(L.ENVTYPE===Zt.LOCAL||!L.ENVTYPE?void 0:e,a,t,L.ENVTYPE,L.SENTRY_RELEASE)},la=({identity:e})=>{w.timeLog("app-initialization","user-state"),j.identity={...e,displayName:e.nickname,type:Ae.CanvasId},j.status="succeeded",Re(j.identity)},ca=i.lazy(()=>$(()=>K(()=>import("./ShrinkingEmptyState-B9CFHPUa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])))),da=({serializedError:e})=>{const a=O(),{formatMessage:t}=a,n=_e(e),s={name:n.name,message:n.message,stack:n.stack};return C.failure({metadata:{error:s},force:!0}),$t(new Error(`Couldn't load link with error: ${n}`)),r.jsx(i.Suspense,{fallback:r.jsx(st,{interactionName:"load"}),children:r.jsx(ca,{header:t(P["embed-view.error-heading-text"]),description:t(P["embed-view.error-description-text"]),imageUrl:nt,primaryAction:r.jsx(rt,{appearance:"primary",onClick:()=>window.location.reload(),children:t(P["embed-view.try-again-button-text"])}),maxImageWidth:300,maxImageHeight:250})})},pe={enter:0,exit:100},ua=({hasEntered:e,children:a,onExited:t})=>m.createElement(ra,{in:e,timeout:pe,onExited:t,unmountOnExit:!0,appear:!0},n=>{const l={...{transition:`opacity ${pe.exit}ms`,opacity:0},...{entered:{opacity:1},exiting:{opacity:0}}[n]};return a(l)}),pa=De({position:"fixed",zIndex:me.spotlight(),inset:0,transition:"opacity 220ms"}),ma=e=>{const{onBlanketClicked:a}=e;return we("div",{role:"presentation",css:pa,style:{...e.style,backgroundColor:e.isTinted?`var(--ds-blanket, ${xe})`:"transparent"},onClick:a})},{Consumer:fa,Provider:ga}=i.createContext(void 0),Ea=i.createContext({opened:oe,closed:oe,targets:{}}),{Consumer:Ka,Provider:ha}=Ea,ba=({component:e,children:a})=>m.createElement(e,null,a);class Se extends i.PureComponent{constructor(...a){super(...a),x(this,"state",{spotlightCount:0,targets:{}}),x(this,"targetRef",t=>n=>{this.setState(s=>({targets:{...s.targets,[t]:n||void 0}}))}),x(this,"spotlightOpen",()=>{this.setState(t=>({spotlightCount:t.spotlightCount+1}))}),x(this,"spotlightClose",()=>{this.setState(t=>({spotlightCount:t.spotlightCount-1}))}),x(this,"getStateProviderValue",Te(t=>({opened:this.spotlightOpen,closed:this.spotlightClose,targets:t})))}componentDidMount(){typeof process<"u"}render(){const{blanketIsTinted:a,children:t,component:n,onBlanketClicked:s}=this.props;return m.createElement(ha,{value:this.getStateProviderValue(this.state.targets)},m.createElement(ga,{value:this.targetRef},m.createElement(ba,{component:n||m.Fragment},m.createElement(ua,{hasEntered:this.state.spotlightCount>0},o=>m.createElement(ot,{zIndex:me.spotlight()},m.createElement(ma,{style:o,isTinted:a,onBlanketClicked:s}))),t)))}}x(Se,"defaultProps",{blanketIsTinted:!0});const ya=({children:e,name:a})=>m.createElement(fa,null,t=>t?m.createElement(it,{innerRef:t(a)},m.createElement(m.Fragment,null,e)):e),Ca=()=>{var s;const a=((s=Ce(Le).data.dataSecurityPolicy)==null?void 0:s.pageExport)!==!0,t=lt(void 0);return{attemptCopy:i.useCallback((o,l)=>{a&&l?t([{actionType:"restrictedContentCantBeCopied",type:"warning"}]):o()},[a,t])}},Ia=({contentId:e})=>{const{view:a}=Q(),t=I.useStore(),{attemptCopy:n}=Ca(),s=I.useEqualSelector(c=>ct(c,{contentId:e})),o=i.useCallback(()=>{if(e){const c=t.getState(),p=dt(c,{contentId:e});return ut(c,{contentId:e}).filter(E=>te(p,E.fieldId).type===Pe.ATTACHMENT).some(E=>{const h=te(p,E.fieldId),v=ke(p,E.entryId),A=Be(p,h,v);return!Oe({database:p,field:h,entry:v,value:A},c)})}return!1},[e,t]),l=i.useCallback(()=>{pt(e,t.getState(),a.settings)},[e,t,a.settings]),d=i.useCallback(c=>{var p;((p=getSelection())==null?void 0:p.type)!=="Range"&&(c.preventDefault(),l())},[l]),u=i.useCallback(c=>{n(()=>{d(c)},o())},[n,d,o]);i.useEffect(()=>{if(s)return document.addEventListener("copy",u),()=>{document.removeEventListener("copy",u)}},[u,l,s])},Sa=({contentId:e})=>{const{showPanel:a,hidePanel:t,isPanelVisible:n}=V(),s=mt(e),o=s==null?void 0:s.wasCreatedThisSession;i.useEffect(()=>{n("DatabaseSetupPanel")&&t(),o&&a("DatabaseSetupPanel")},[])},va=({contentId:e})=>{const{entryId:a}=J(),[t,n]=i.useState(!1),s=I.useDispatch(),{showPanel:o}=V(),l=O(),{formatMessage:d}=l,u=I.useEqualSelector(c=>{const p=W(c,{contentId:e});return!!(a?p&&!Ve(p)&&Ne(p,a):null)});i.useEffect(()=>{!t&&a&&u?(o("EntryViewPanel",{entryId:a}),s(ft({contentId:e,entryId:a}))):a&&!u&&Fe.setMessage(d(P["snackbar-error.deleted-linked-entry"]),{id:"linked-database-entry-deleted",type:"info",showCloseButton:!0}),n(!0)},[e,s,u,a,d,t,o])},Da=()=>{const{hidePanel:e,isPanelVisible:a}=V(),{setActivePanelSetting:t}=gt(),n=I.useDispatch(),{closeMenu:s}=Et();ht(Ct,()=>{a()?(a("ViewSettingsPanel")&&t(null),e(),n(bt({value:!1}))):(je(),n(yt()),s())},!1)},wa=({contentId:e})=>{const t=!!fe(),[n,s,o]=I.useEqualSelector(l=>{const d=W(l,{contentId:e}),u=d.meta.isLocked,c=!t&&d.operations.updateMetadata;return[c,c&&!u,u]});return{canEditFields:s,couldEditFields:n,isLocked:o,isViewingPreviousVersion:t}},xa=({contentId:e})=>{const{view:a}=Q(),t=O(),n=I.useStore(),s=I.useEqualSelector(o=>W(o,{contentId:e}));i.useEffect(()=>{a.settings.filter&&Promise.all(Me(s,a.settings.filter).map(async o=>{await ze({contentId:o.database.contentId,field:o.field,entryId:o.entry.id,value:o.value},n,t)}))},[s,t,n,a.settings.filter])},Ta=i.lazy(()=>$(()=>K(()=>import("./UnsavedViewChangesBanner-D5iQLql4.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,12,15,16]))).then(e=>({default:e.UnsavedViewChangesBanner}))),Aa={"unsaved-view-changes":Ta},Ra=m.memo(function({id:a}){const t=Aa[a];return r.jsx(i.Suspense,{children:r.jsx(t,{bannerId:a})})}),_a=()=>{const{activeBanners:e}=It();return r.jsx(r.Fragment,{children:e.map(a=>r.jsx(Ra,{id:a},a))})},La=({contentId:e,isContentEditable:a=!1,actions:t})=>{const n=xt(),s=X(),o=I.useDispatch(),{showPanel:l}=V(),{view:d}=Q(),{setOpenThread:u,focusedCommentThreadId:c}=St(),[p,T]=i.useState(null),[_,E,h]=I.useEqualSelector(F=>{const f=vt(F,{contentId:e,viewSettings:d.settings,includeDeleted:!1}),D=f.commentThreads,g=c?z(c,D):void 0,S=!!(g!=null&&g.entryId&&(g!=null&&g.fieldId)&&(!f.entries.includes(g.entryId)||!f.fields.includes(g.fieldId)||d.settings.layout.type===ae.CARD||d.settings.layout.type===ae.BOARD));return[f.operations,D,S]});Sa({contentId:e}),Ia({contentId:e}),va({contentId:e}),xa({contentId:e});const[v,A]=i.useState(null),b=a&&_.updateEntries,{canEditFields:y,couldEditFields:N}=wa({contentId:e});return i.useEffect(()=>{const F=async()=>{var D;const f=await B();f&&((D=f.registerOnReopenResolvedComment)==null||D.call(f,g=>{const S=z(g.referenceId,E);if(S!=null&&S.fieldId&&S.entryId&&S.thread&&g.referenceId){const{fieldId:Z,entryId:ee}=S;o(Tt(e,"main",{type:Ue.SET_VALUE_COMMENT_THREAD_RESOLVED,entryId:ee,fieldId:Z,threadId:g.referenceId,isResolved:!1})),u({valueId:se(ee,Z),threadId:S.thread.threadId})}}))};if(q()&&F(),c){const f=z(c,E);if(f&&f.entryId&&f.fieldId){const{fieldId:D,entryId:g}=f;u({valueId:se(g,D),threadId:f.thread.threadId,panel:h}),h&&l("EntryViewPanel",{entryId:g,isReadonly:!b})}}},[b,E,e,o,c,u,h,l,d.settings.layout.type]),Dt(i.useCallback(async()=>{await n.sendDatabaseContentViewedEvent({contentId:e,databaseContainer:q()?ie.STANDALONE_DATABASE:ie.EMBED_DATABASE,locale:s})},[n,e,s])),Da(),r.jsx(r.Fragment,{children:r.jsxs(Se,{blanketIsTinted:!1,children:[r.jsx(aa,{coordinationMessageKey:sa,isEnabled:!ge(),targetRef:v,delay:!0}),r.jsx(ya,{name:na,children:r.jsx("div",{ref:A,style:{position:"absolute",right:ne("space.250","20px"),bottom:ne("space.500","40px")}})}),r.jsx(wt,{banners:r.jsx(_a,{}),outerContainerRef:p,view:r.jsx(Ee,{outerContainerRef:p,setOuterContainerRef:T,contentId:e,canEditContent:b,couldEditFields:N,canEditFields:y,isContentEditable:a}),toolbar:r.jsx(he,{contentId:e,actions:t,canEditFields:y,canEditContent:b})})]})})},Pa=q(),ve=["import","print","help","copy","feedback"];Pa&&ve.push("lock");const ka=()=>{const{contentId:e}=J(),a=fe(),t=At.useEqualSelector(n=>He(n,{contentId:e}));return i.useEffect(()=>{const n=async()=>{var s,o;C.mark("database-load-end"),C.success({force:!0}),(o=(s=await B()).onContentLoadSucceeded)==null||o.call(s,{})};(t==null?void 0:t.status)===M.SUCCEEDED&&n()},[t==null?void 0:t.status,e]),(t==null?void 0:t.status)===M.ERROR?r.jsx(da,{serializedError:t.error}):(t==null?void 0:t.status)===M.SUCCEEDED?r.jsx(La,{contentId:e,isContentEditable:!a,actions:ve}):r.jsx(Rt,{})},Ba=({children:e})=>{const a=m.useRef(null);return i.useEffect(()=>{const t=a.current;if(!t)return;const n=new window.ResizeObserver(()=>{const o=Math.ceil(t.getBoundingClientRect().height);setTimeout(()=>{window.parent.postMessage(JSON.stringify({method:"resize",height:Math.max(o,1)}),"*")},0)});return(()=>{n.observe(t)})(),()=>{n.unobserve(t)}},[a]),r.jsx("div",{ref:a,"data-testid":"value-resize-observer",children:e})},G=({children:e,isValueEmbed:a})=>r.jsx(Ye,{testId:"embed-wrapper",xcss:[a?re({padding:"space.0"}):re({display:"flex",flexFlow:"column",position:"absolute",height:"100%",width:"100%",overflow:"hidden",paddingTop:"space.0",paddingBottom:"space.0",paddingRight:"space.200",paddingLeft:"space.200"})],children:e}),Oa=()=>{const{contentId:e,entryId:a,fieldId:t,referencing:n}=J();_t(),Lt(),Pt(e);const s=ge();return i.useEffect(()=>{kt.reactAppIsReady=!0},[]),s&&n?(C.setPageLoadId(R.EMBED_REFERENCE_LOAD),r.jsx(G,{children:r.jsx(Bt,{ToolbarComponent:he,DatabasePreviewComponent:Ee,EntryPreviewComponent:le,ValuePreviewComponent:ce})})):s&&e&&a&&t?(C.setPageLoadId(R.EMBED_VALUE_LOAD),r.jsx(Ba,{children:r.jsx(G,{isValueEmbed:!0,children:r.jsx(ce,{contentId:e,entryId:a,fieldId:t})})})):s&&e&&a?(C.setPageLoadId(R.EMBED_ENTRY_LOAD),r.jsx(G,{children:r.jsx(le,{contentId:e,entryId:a})})):(C.setPageLoadId(s?R.EMBED_DETAIL_LOAD:R.STANDALONE_DETAIL_LOAD),r.jsx(r.Fragment,{children:e?r.jsx(ka,{}):null}))},Va=()=>{const{cloudId:e,spaceId:a,spaceKey:t,userId:n,contentId:s,activationId:o,contentReferenceId:l,spaceName:d,title:u,token:c}=Ce(k).data;w.timeLog("app-initialization","standalone-app-render");const p=O(),[T,_]=i.useState(!1),E=i.useRef(null);i.useEffect(()=>{Qt.initialized().then(()=>{_(!0)}),window.focus(),(async()=>{const y=await B();y.onThemeChange&&y.onThemeChange(N=>{Vt(N)})})()},[]),i.useEffect(()=>{Ge(qe(c))},[c]),i.useEffect(()=>{Ke(e)},[e]),i.useEffect(()=>{Xe(o)},[o]),i.useEffect(()=>{Je(async()=>{de.dispatch(Nt({space:{key:t},userId:n}))})},[t,n]),i.useEffect(()=>{const b=async()=>{const y=await B();if(y!=null&&y.onCloseConfluenceSidePanel)return y.onCloseConfluenceSidePanel()};E.current?E.current!==s&&(b(),E.current=s):E.current=s},[s]);const h=i.useMemo(()=>new URLSearchParams(window.parent.location.search),[window.parent.location.search]),v=i.useCallback(()=>{try{const b=window.top&&window.top.location.pathname;return b?We(b):null}catch{return null}},[]),A=i.useMemo(()=>({contentId:s,referencing:h.get("mode")==="referencing",activationId:o,cloudId:e,setContentId:()=>{},spaceKey:t,savedViewId:h.get("savedViewId"),unsavedViewId:h.get("unsavedView"),entryId:h.get("entryId"),fieldId:h.get("fieldId"),referenceId:l,spaceId:a,parentContentId:v(),spaceName:d,title:u}),[s,o,e,t,l,a,d,u,h,v]);return i.useEffect(()=>{!s||!l||!a||!t||(w.timeLog("app-initialization","database-load-start"),C.mark("database-load-start"),de.dispatch($e({contentId:s,referenceId:l,spaceId:Number(a),spaceKey:t,intl:p,spaceName:d??"",title:u??""},{throttle:!1})))},[s,p,l,a,t,d,u]),T?r.jsx(Qe.Provider,{value:A,children:r.jsx(Ot,{aaid:n,children:r.jsx(Oa,{})})}):null},Na=m.memo(Va),Fa=()=>{const e=X();return w.timeLog("app-initialization","app-with-locale"),r.jsx(be,{locale:e,children:r.jsx(Na,{})})};window.Buffer=Ft.Buffer;const ja=m.lazy(()=>$(()=>K(()=>import("./DatabaseFatalError-CkLhcYzI.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,13]))));(async()=>{try{ea(),jt(),Mt(),Ze(et()),w.time("app-initialization"),C.startPageLoad("pending",!0,performance.now());const{cloudId:e,spaceId:a,userId:t,identity:n}=await oa();await zt({cloudId:e,userId:t}),Ut(H("confluence_typography_refreshed",!1)),Ht({"databases-frontend-ci2-m1":H("databases-frontend-ci2-m1",!1),"databases-frontend-live-doc":H("databases-frontend-live-doc",!1)}),ta({cloudId:e,userId:t}),la({identity:n}),ia({cloudId:e,spaceId:a,userId:t}),Yt(),U(document.getElementById("app")).render(r.jsx(Fa,{})),ye.registerSingleton("FlagsManager",()=>new Gt),qt((o,l)=>U(o).render(r.jsx(Kt,{flags:l.flags,handleFlagDismiss:d=>l.handleFlagDismiss(d)})))}catch(e){let a;if(e instanceof Error){ue(e),a=tt(e),a={name:a.name,message:a.message,stack:a.stack,code:a.code},C.failure({metadata:{error:a},force:!0});try{const t=({error:n})=>r.jsx(be,{locale:X(),children:r.jsx(i.Suspense,{children:r.jsx(ja,{error:n})})});U(document.getElementById("app")).render(r.jsx(t,{error:e}))}catch(t){t instanceof Error&&(ue(t),document.getElementById("global-error").innerText=e.message,document.getElementById("global-error").style.display="",document.getElementById("app").style.display="none")}}}})();export{wa as u};
//# sourceMappingURL=standalone-DGm-0SZU.js.map
